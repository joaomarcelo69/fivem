<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu de Emprego</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <div class="window" v-if="open">
      <div class="title">Menu de Emprego <small v-if="context.job">({{ context.job }})</small></div>
      <div class="content">
        <div v-if="isLeo(context.job)">
          <h3>Multas</h3>
          <p v-if="!context.onDuty"><em>Tem de estar em serviço para emitir/reimprimir.</em></p>
          <div class="form">
            <label>CitizenID</label>
            <input v-model="fine.citizenid" placeholder="Ex.: PT1003" />
            <label>Valor (€)</label>
            <input v-model.number="fine.amount" type="number" min="1" step="1" />
            <label>Motivo</label>
            <input v-model="fine.reason" placeholder="Ex.: Excesso de velocidade" />
            <label>ID da Multa (opcional para reimprimir)</label>
            <input v-model="fine.id" type="number" min="1" step="1" placeholder="Ex.: 42" />
            <div class="actions">
              <button @click="issueFine" :disabled="!canIssueFine">Emitir Multa</button>
              <button @click="reprintFine" :disabled="!canReprint">Reimprimir Talão</button>
            </div>
          </div>
          <h3 style="margin-top: 16px;">Operação STOP</h3>
          <div class="form">
            <label>Source ID do condutor (próximo)</label>
            <input v-model="stop.targetSrc" placeholder="Ex.: 12" />
            <div class="actions">
              <button @click="stopCheckDocs">Verificar Documentos</button>
              <button @click="stopImpound" :disabled="!stop.docs || (stop.docs.insurance && stop.docs.insurance.valid && stop.docs.inspection && stop.docs.inspection.valid)">Apreender (sem docs)</button>
            </div>
            <div v-if="stop.docs" class="stop-docs">
              <div><strong>Matrícula:</strong> {{ stop.docs.plate }}</div>
              <div><strong>Seguro:</strong> <span :class="stop.docs.insurance.valid ? 'ok' : 'bad'">{{ stop.docs.insurance.valid ? ('Válido até ' + stop.docs.insurance.expiresAt) : 'Em falta/expirado' }}</span></div>
              <div><strong>Inspeção:</strong> <span :class="stop.docs.inspection.valid ? 'ok' : 'bad'">{{ stop.docs.inspection.valid ? ('Válida até ' + stop.docs.inspection.expiresAt) : 'Em falta/expirada' }}</span></div>
            </div>
          </div>
        </div>
        <div v-if="context.job">
          <h3 style="margin-top: 12px;">Ações do Emprego</h3>
          <div v-if="actions.length === 0">
            <em>Sem ações disponíveis para este emprego (ou necessita estar em serviço).</em>
          </div>
          <ul>
            <li v-for="a in actions" :key="a.id">
              {{ a.label }}
              <button style="margin-left: 8px;" @click="execAction(a.id)">Executar</button>
            </li>
          </ul>
        </div>
        <div v-else>
          <p>Emprego não definido.</p>
        </div>
      </div>
      <div class="footer">
        <button @click="close">Fechar</button>
      </div>
    </div>
    <!-- Route HUD overlay -->
    <div class="route-hud" v-if="routeHud.show">
      <div class="chip">{{ routeHud.job.toUpperCase() }} • {{ routeHud.idx }}/{{ routeHud.len }}</div>
      <div class="money">+€ {{ routeHud.last }}</div>
      <div class="total">Total: € {{ routeHud.total }}</div>
      <div class="dist" v-if="routeHud.dist !== null">Próximo: {{ Math.round(routeHud.dist) }}m</div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
  <script src="app.js"></script>
</body>
</html>
